<!DOCTYPE html>
<html lang="fr">
<head>
    <title>Liaison Points d'Énergie</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no">
    <style>
        body {
            font-family: Monospace;
            background-color: #BD786C;            
            margin: 0px;
            overflow: hidden;
        }

        #pointLabel {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%) rotate(-90deg);
            transform-origin: left top;
            color: #3a2d27;
            font-family: Arial, sans-serif;
            white-space: nowrap;
            z-index: 9999;
            pointer-events: none;
        }

        #pointLabel .point-name {
            font-weight: bold;
            font-size: 18px;
            margin-right: 6px;
        }

        #pointLabel .copyright {
            font-size: 11px;
        }
    </style>
</head>
<body>
<div id="pointLabel"></div>

<script src="three/build/three.js"></script>
<script src="three/loaders/OBJLoader.js"></script>
<script src="three/controls/OrbitControls.js"></script>

<script>

let container, camera, scene, renderer, controls;
let raycaster = new THREE.Raycaster();
let mouse = new THREE.Vector2();
let lastClickedPoint = null;

// Initialisation des écouteurs pour les points d'acupression
        function initEventListeners() {
            const meridianPoints = [
                { id: 'p', count: 11 },
                { id: 'gi', count: 22 },
                { id: 'e', count: 45 },
                { id: 'rp', count: 21 },
                { id: 'c', count: 9 },
                { id: 'ig', count: 19 },
                { id: 'v', count: 67 },
                { id: 'r', count: 27 },
                { id: 'pc', count: 9 },
                { id: 'tr', count: 23 },
                { id: 'vb', count: 44 },
                { id: 'f', count: 14 },
                { id: 'vg', count: 28 },
                { id: 'vc', count: 24 },
                { id: 'cs', count: 1 }
            ];
    
function createSphere(name, color, x, y, z, view = null) {
    const geometry = new THREE.SphereGeometry(0.3, 32, 32);
    const material = new THREE.MeshLambertMaterial({ color });
    const object = new THREE.Mesh(geometry, material);
    object.name = name;
    object.position.set(x, y, z);
    if (view !== null) object.view = view;
    scene.add(object);
}

function drawMeridianCurve(pointNames, colorHex) {

    const points = [];

    pointNames.forEach(name => {
        const obj = scene.getObjectByName(name);
        if (obj) {

            // Projection légèrement hors du corps
            const outward = obj.position.clone().normalize().multiplyScalar(0.8);
            const liftedPoint = obj.position.clone().add(outward);

            points.push(liftedPoint);
        }
    });

    if (points.length < 2) return;

    const curve = new THREE.CatmullRomCurve3(points);
    curve.curveType = 'catmullrom';
    curve.tension = 0.5;

    const tubeGeometry = new THREE.TubeGeometry(curve, 300, 0.15, 16, false);
    const tubeMaterial = new THREE.MeshLambertMaterial({ color: colorHex });
    const tube = new THREE.Mesh(tubeGeometry, tubeMaterial);

    scene.add(tube);
}

function init() {

    container = document.createElement('div');
    document.body.appendChild(container);

    camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.5, 2000);
    camera.position.set(0, 0, 250);

    controls = new THREE.OrbitControls(camera);
    controls.enableRotate = false;
    controls.enablePan = false;

    scene = new THREE.Scene();

    scene.add(new THREE.AmbientLight(0x404040));

    const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
    directionalLight.position.set(0, 0, 1);
    scene.add(directionalLight);

    // Création des sphères
        createSphere('cs7', Math.random() * 0x0000FF, -24.71516683000315, -6.555406638283143, 0.6);
    
    // =========================
    // Vaisseau Conception
    // =========================

    const vcPositions = [
        { name: 'vc1', x: 0.05, y: -12.7, z: -4.2 },
        { name: 'vc2', x: 0.05, y: -6, z: 6.4 },
        { name: 'vc3', x: 0.05, y: -2.9, z: 7.1 },
        { name: 'vc4', x: 0.05, y: 0.2, z: 7.17 },
        { name: 'vc5', x: 0.05, y: 3.3, z: 7.25 },
        { name: 'vc6', x: 0.05, y: 6.4, z: 7.3 },
        { name: 'vc7', x: 0.05, y: 9.5, z: 7.2 },
        { name: 'vc8', x: 0.05, y: 12.7, z: 6.1 },
        { name: 'vc9', x: 0.05, y: 15.9, z: 6.1 },
        { name: 'vc10', x: 0.05, y: 18.4, z: 6.38 },
        { name: 'vc11', x: 0.05, y: 20.9, z: 6.38 },
        { name: 'vc12', x: 0.05, y: 23.4, z: 6.58 },
        { name: 'vc13', x: 0.05, y: 25.9, z: 6.6 },
        { name: 'vc14', x: 0.05, y: 28.4, z: 5.95 },
        { name: 'vc15', x: 0.05, y: 30.9, z: 5.06 },
        { name: 'vc16', x: 0.05, y: 33.4, z: 4.9 },
        { name: 'vc17', x: 0.05, y: 36, z: 4.7 },
        { name: 'vc18', x: 0.05, y: 38.6, z: 3.6 },
        { name: 'vc19', x: 0.05, y: 41.2, z: 2.4 },
        { name: 'vc20', x: 0.05, y: 43.8, z: 1.2 },
        { name: 'vc21', x: 0.05, y: 46.4, z: -0.9 },
        { name: 'vc22', x: 0.05, y: 49, z: -2.1 },
        { name: 'vc23', x: 0.02, y: 56, z: -0.2 },
        { name: 'vc24', x: 0.02, y: 60, z: 5 }
    ];

    vcPositions.forEach(p => createSphere(p.name, 0x9370DB, p.x, p.y, p.z));
    drawMeridianCurve(vcPositions.map(p => p.name), 0x9370DB);

    // =========================
    // Poumon
    // =========================

    const pPositions = [
        { name: 'p1', x: 13.2, y: 46, z: -1.1 },
        { name: 'p2', x: 14.2, y: 48.6, z: -4.6 },
        { name: 'p3', x: 22.9, y: 32.4, z: -4.7 },
        { name: 'p4', x: 23.5, y: 28.7, z: -5 },
        { name: 'p5', x: 24.1, y: 15.7, z: -4.6 },
        { name: 'p6', x: 25.7, y: 7.5, z: -2.7 },
        { name: 'p7', x: 26.9, y: -1.5, z: -1.5 },
        { name: 'p8', x: 26.2, y: -3.5, z: -0.5 },
        { name: 'p9', x: 27.3, y: -5.5, z: -0.3 },
        { name: 'p10', x: 27.6, y: -7.7, z: 2.1 },
        { name: 'p11', x: 30.5, y: -13.2, z: 6 }
    ];

    pPositions.forEach(p => createSphere(p.name, 0xf5f5f0, p.x, p.y, p.z));
    drawMeridianCurve(pPositions.map(p => p.name), 0xf5f5f0);

    // =========================
    // Gros Intestin
    // =========================

    const giPositions = [
        { name: 'gi1', x: 29.232201993135632, y: -20.00000000000036, z: 6.199999999999994, view: 1 },
        { name: 'gi2', x: 29.332201993135634, y: -14.700000000000307, z: 2.8000000000000007, view: 1 },
        { name: 'gi3', x: 29.532201993135637, y: -12.200000000000315, z: 1.7999999999999998, view: 1 },
        { name: 'gi4', x: 29.532201993135637, y: -10.500000000000322, z: 0.39999999999999936, view: -2 },
        { name: 'gi5', x: 28.33220199313562, y: -6.800000000000335, z: 0.39999999999999925, view: 1 },
        { name: 'gi6', x: 28.032201993135615, y: -0.3000000000003421, z: -3.8000000000000025, view: 1 },
        { name: 'gi7', x: 27.832201993135612, y: 4.399999999999659, z: -6.399999999999994, view: 1 },
        { name: 'gi8', x: 27.73220199313561, y: 9.69999999999964, z: -8.099999999999989, view: 1 },
        { name: 'gi9', x: 27.532201993135608, y: 11.999999999999632, z: -8.799999999999986, view: 1 },
        { name: 'gi10', x: 27.232201993135604, y: 14.299999999999624, z: -9.299999999999985, view: 1 },
        { name: 'gi11', x: 27.0322019931356, y: 17.59999999999964, z: -8.799999999999986, view: 1 },
        { name: 'gi12', x: 26.632201993135595, y: 18.49999999999968, z: -8.599999999999987, view: 1 },
        { name: 'gi13', x: 26.432201993135592, y: 23.499999999999723, z: -9.299999999999985, view: 1 },
        { name: 'gi14', x: 24.73220199313557, y: 33.29999999999986, z: -7.599999999999991, view: 1 },
        { name: 'gi15', x: 20.432201993135507, y: 47.20000000000006, z: -5, view: 1 },
        { name: 'gi16', x: 9.132201993135475, y: 45.80000000000008, z: -17.48, view: 1 },
        { name: 'gi17', x: 5.532201993135482, y: 54.10000000000016, z: -4.0000000000000036 },
        { name: 'gi18', x: 5.132201993135483, y: 56.100000000000186, z: -3.600000000000003 },
        { name: 'gi19', x: 0.9322019931354847, y: 62.400000000000276, z: 4.899999999999998 },
        { name: 'gi20', x: 1.9322019931354855, y: 62.90000000000028, z: 4.3 },
        { name: 'gi21', x: -0.9322019931354847, y: 62.400000000000276, z: 4.899999999999998 },
        { name: 'gi22', x: -1.9322019931354855, y: 62.90000000000028, z: 4.3 }
    ];

    giPositions.forEach(p => createSphere(p.name, 0x00CED1, p.x, p.y, p.z));
    drawMeridianCurve(giPositions.map(p => p.name), 0x00CED1);

                    // Estomac
            const ePositions = [
                { name: 'e1', x: -2.9677980068645167, y: 66.70000000000014, z: 3 },
                { name: 'e2', x: -2.9677980068645167, y: 66.00000000000018, z: 3.2 },
                { name: 'e3', x: -2.8677980068645166, y: 63.700000000000294, z: 3.8000000000000007 },
                { name: 'e4', x: -2.7677980068645165, y: 61.10000000000026, z: 4.1000000000000005 },
                { name: 'e5', x: -3.367798006864517, y: 58.200000000000216, z: 2.4999999999999996, view: -1 },
                { name: 'e6', x: -5.967798006864511, y: 61.30000000000026, z: -2.6000000000000028, view: -1 },
                { name: 'e7', x: -6.467798006864509, y: 64.20000000000029, z: -2.700000000000003, view: -1 },
                { name: 'e8', x: -6.26779800686451, y: 71.89999999999985, z: -2.700000000000003, view: -1 },
                { name: 'e9', x: -2.9677980068645167, y: 54.20000000000016, z: -2.3000000000000025 },
                { name: 'e10', x: -2.267798006864516, y: 51.40000000000012, z: -2.2000000000000024 },
                { name: 'e11', x: -2.9677980068645167, y: 47.600000000000065, z: -1.2000000000000015 },
                { name: 'e12', x: -6.667798006864508, y: 48.60000000000008, z: -2.2000000000000024 },
                { name: 'e13', x: -7.067798006864507, y: 47.600000000000065, z: -1.0000000000000013 },
                { name: 'e14', x: -7.667798006864505, y: 44.800000000000026, z: 0.8999999999999986 },
                { name: 'e15', x: -8.767798006864501, y: 42.29999999999999, z: 2.3999999999999995 },
                { name: 'e16', x: -9.867798006864497, y: 38.89999999999994, z: 4.2 },
                { name: 'e17', x: -12.06779800686449, y: 33.19999999999986, z: 4.999999999999997 },
                { name: 'e18', x: -12.06779800686449, y: 30.199999999999818, z: 2.1999999999999993 },
                { name: 'e19', x: -3.167798006864517, y: 25.699999999999754, z: 6.599999999999992 },
                { name: 'e20', x: -3.167798006864517, y: 22.64727272727248, z: 6.699999999999991 },
                { name: 'e21', x: -3.167798006864517, y: 19.59454545454521, z: 6.699999999999991 },
                { name: 'e22', x: -3.167798006864517, y: 16.541818181817938, z: 6.499999999999992 },
                { name: 'e23', x: -3.167798006864517, y: 13.489090909090663, z: 6.699999999999991 },
                { name: 'e24', x: -3.167798006864517, y: 10.43636363636339, z: 7.09999999999999 },
                { name: 'e25', x: -3.167798006864517, y: 7.383636363636118, z: 6.99999999999999 },
                { name: 'e26', x: -3.167798006864517, y: 4.330909090908847, z: 6.899999999999991 },
                { name: 'e27', x: -3.167798006864517, y: 1.2781818181815723, z: 6.599999999999992 },
                { name: 'e28', x: -3.167798006864517, y: -1.7745454545457022, z: 6.299999999999993 },
                { name: 'e29', x: -3.167798006864517, y: -4.827272727272973, z: 5.699999999999995 },
                { name: 'e30', x: -3.167798006864517, y: -7.880000000000244, z: 4.599999999999999 },
                { name: 'e31', x: -12.467798006864488, y: -11.280000000000232, z: 4.100000000000001 },
                { name: 'e32', x: -12.467798006864488, y: -28.48000000000039, z: 4.300000000000001 },
                { name: 'e33', x: -12.467798006864488, y: -36.2800000000005, z: 2.900000000000001 },
                { name: 'e34', x: -12.467798006864488, y: -38.98000000000054, z: 2.3000000000000003 },
                { name: 'e35', x: -12.467798006864488, y: -47.18000000000065, z: 1.4999999999999996 },
                { name: 'e36', x: -12.467798006864488, y: -53.18000000000074, z: -0.10000000000000153 },
                { name: 'e37', x: -12.467798006864488, y: -63.68000000000089, z: -0.7000000000000015 },
                { name: 'e38', x: -11.76779800686449, y: -69.78000000000057, z: -1.6000000000000019 },
                { name: 'e39', x: -11.367798006864492, y: -73.28000000000037, z: -1.9000000000000021 },
                { name: 'e40', x: -13.467798006864484, y: -69.48000000000059, z: -4.3000000000000025, view: -1 },
                { name: 'e41', x: -8.667798006864501, y: -85.1799999999997, z: -0.8000000000000016 },
                { name: 'e42', x: -9.967798006864497, y: -88.27999999999952, z: 0.9999999999999983 },
                { name: 'e43', x: -8.8677980068645, y: -90.97999999999936, z: 6.099999999999993 },
                { name: 'e44', x: -9.467798006864498, y: -91.87999999999931, z: 7.799999999999988 },
                { name: 'e45', x: -9.967798006864497, y: -93.17999999999924, z: 11.299999999999976 }
            ];

    ePositions.forEach(p => createSphere(p.name, 0xFFD700, p.x, p.y, p.z));
    drawMeridianCurve(ePositions.map(p => p.name), 0xFFD700);




    // =========================

    renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setClearColor(0xBD786C);
    renderer.setSize(window.innerWidth, window.innerHeight);
    container.appendChild(renderer.domElement);

    window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    });

    animate();
}

function animate() {
    requestAnimationFrame(animate);
    renderer.render(scene, camera);
}

init();

</script>
</body>
</html>
